<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Geojit FIRE Coach ‚Äì Mutual Fund SIP Readiness Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Open Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gj-teal: #07877B;
      --gj-teal-dark: #05645c;
      --gj-yellow: #F5CF47;
      --gj-yellow-soft: #F6D970;
      --gj-content: #E5E7EB;
      --gj-body-bg: #020617; /* dark */
      --gj-card-bg: #020617; /* chat background */
      --gj-panel-bg: #0f172a; /* right panel dark slate */
      --gj-panel-alt: #111827;
      --gj-border: #1f2937;
      --gj-border-soft: #374151;
      --gj-muted: #9CA3AF;
      --gj-error: #F97373;
      --gj-grey-light: #111827;
      --gj-grey-dark: #E5E7EB;
      --gj-shadow-soft: 0 8px 18px rgba(0,0,0,0.45);
      --gj-shadow-strong: 0 14px 32px rgba(0,0,0,0.6);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000000 100%);
      color: var(--gj-content);
      min-height: 100vh;
    }

    a { color: var(--gj-yellow-soft); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: rgba(15,23,42,0.95);
      border-bottom: 1px solid var(--gj-border);
      padding: 8px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 12px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-block {
      width: 120px;
      height: 26px;
      background: var(--gj-teal);
      border-radius: 3px;
      position: relative;
      overflow: hidden;
    }
    .logo-block::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, #FFFFFF 0, #FFFFFF 40%, transparent 70%);
      opacity: 0.12;
    }

    .logo-text {
      font-size: 17px;
      font-weight: 700;
      color: #F9FAFB;
    }

    .header-cta {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--gj-muted);
    }

    .btn-header {
      border-radius: 999px;
      padding: 6px 14px;
      border: 1px solid var(--gj-teal);
      background: rgba(7,135,123,0.14);
      color: #E5FFFB;
      cursor: pointer;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-header:hover {
      background: rgba(7,135,123,0.24);
    }

    /* Main layout */
    .main {
      flex: 1;
      padding: 18px 12px 24px;
    }

    .container {
      max-width: 1120px;
      margin: 0 auto;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.3fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    /* Chat panel */
    .chat-panel {
      background: radial-gradient(circle at top left, #111827 0, #020617 60%);
      border-radius: 20px;
      border: 1px solid var(--gj-border-soft);
      box-shadow: var(--gj-shadow-soft);
      display: flex;
      flex-direction: column;
      height: 78vh;
      max-height: 660px;
      min-height: 500px;
    }

    .chat-header {
      padding: 12px 14px;
      border-bottom: 1px solid var(--gj-border);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .coach-avatar {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 10%, #F59E0B 0, #EA580C 35%, #7C2D12 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #FEFCE8;
      font-size: 20px;
      box-shadow: 0 0 18px rgba(248,250,252,0.3);
    }

    .coach-text-block {
      display: flex;
      flex-direction: column;
    }

    .coach-name {
      font-size: 13px;
      font-weight: 600;
      color: #F9FAFB;
    }

    .coach-sub {
      font-size: 11px;
      color: var(--gj-muted);
    }

    .chat-body {
      flex: 1;
      padding: 12px 12px 6px;
      overflow-y: auto;
      background: radial-gradient(circle at top, #020617 0, #020617 70%);
    }

    .chat-footer {
      border-top: 1px solid var(--gj-border);
      padding: 8px 10px;
      background: #020617;
      border-radius: 0 0 20px 20px;
    }

    .bubble {
      max-width: 90%;
      padding: 8px 10px;
      border-radius: 14px;
      margin-bottom: 8px;
      font-size: 13px;
      line-height: 1.4;
      box-shadow: 0 1px 4px rgba(0,0,0,0.45);
    }

    .bubble-assistant {
      background: rgba(15,23,42,0.96);
      border: 1px solid var(--gj-border-soft);
      border-bottom-left-radius: 4px;
      color: #E5E7EB;
    }

    .bubble-user {
      background: linear-gradient(135deg, #22C55E 0, #16A34A 40%, #166534 100%);
      border: 1px solid rgba(34,197,94,0.6);
      border-bottom-right-radius: 4px;
      margin-left: auto;
      color: #ECFDF5;
    }

    .bubble-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--gj-muted);
      margin-bottom: 2px;
      display: block;
    }

    .bubble-strong {
      font-weight: 600;
      color: #FACC15;
    }

    .chat-input-area {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .field-label {
      font-size: 11px;
      color: var(--gj-muted);
    }

    .input-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chat-input {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid var(--gj-border-soft);
      padding: 7px 12px;
      font-size: 13px;
      background: #020617;
      color: var(--gj-grey-dark);
    }

    .chat-input::placeholder {
      color: var(--gj-muted);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--gj-teal);
      box-shadow: 0 0 0 1px rgba(7,135,123,0.3);
    }

    .btn-next {
      border-radius: 999px;
      padding: 7px 14px;
      border: none;
      background: linear-gradient(135deg, #22C55E 0, #16A34A 50%, #15803D 100%);
      color: #ECFDF5;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      box-shadow: 0 8px 18px rgba(22,163,74,0.6);
    }

    .btn-next:hover {
      filter: brightness(1.08);
    }

    .error-text {
      font-size: 11px;
      color: var(--gj-error);
    }

    /* Slider UI inside chat */
    .slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .slider-row input[type="range"] {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 999px;
      background: #1F2937;
      outline: none;
    }

    .slider-row input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #22C55E;
      border: 2px solid #020617;
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
      cursor: pointer;
    }
    .slider-row input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #22C55E;
      border: 2px solid #020617;
      cursor: pointer;
    }

    .slider-pill {
      min-width: 96px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--gj-border-soft);
      font-size: 11px;
      text-align: center;
      background: #020617;
      color: var(--gj-grey-dark);
    }

    .tiny-caption {
      font-size: 11px;
      color: var(--gj-muted);
      margin-top: 2px;
    }

    /* Lifestyle buttons in chat */
    .lifestyle-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .lifestyle-btn {
      border-radius: 16px;
      border: 1px solid var(--gj-border-soft);
      padding: 6px 10px;
      font-size: 12px;
      background: #020617;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--gj-grey-dark);
    }

    .lifestyle-btn.selected,
    .lifestyle-btn:hover {
      border-color: #22C55E;
      background: rgba(22,163,74,0.12);
    }

    /* Risk buttons */
    .risk-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .risk-btn {
      border-radius: 16px;
      border: 1px solid var(--gj-border-soft);
      padding: 6px 10px;
      font-size: 12px;
      background: #020617;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--gj-grey-dark);
    }

    .risk-btn.selected,
    .risk-btn:hover {
      border-color: #F59E0B;
      background: rgba(248, 165, 32, 0.14);
    }

    /* Results panel */
    .results-panel {
      background: linear-gradient(145deg, #020617 0, #0f172a 40%, #020617 100%);
      border-radius: 20px;
      border: 1px solid var(--gj-border-soft);
      box-shadow: var(--gj-shadow-soft);
      padding: 14px 14px 16px;
      height: 78vh;
      max-height: 660px;
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }

    .results-header {
      margin-bottom: 8px;
    }

    .results-title {
      font-size: 16px;
      font-weight: 600;
      color: #F9FAFB;
    }

    .results-sub {
      font-size: 12px;
      color: var(--gj-muted);
    }

    .results-main {
      margin-top: 10px;
      border-radius: 14px;
      background: radial-gradient(circle at top right, #1f2937 0, #020617 70%);
      border: 1px solid rgba(251,214,204,0.18);
      padding: 10px 10px 12px;
    }

    .corpus-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--gj-muted);
    }

    .corpus-value {
      font-size: 22px;
      font-weight: 700;
      color: #FCD34D;
      margin-top: 4px;
    }

    .corpus-caption {
      font-size: 12px;
      color: var(--gj-grey-dark);
      margin-top: 4px;
    }

    .bar-wrap { margin-top: 8px; }
    .bar-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--gj-muted);
      margin-bottom: 4px;
    }

    .bar-outer {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid #111827;
    }

    .bar-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #FDE68A 0, #22C55E 50%, #16A34A 100%);
      transition: width 0.6s ease-out;
    }

    .score-pill {
      border-radius: 999px;
      border: 1px solid #22C55E;
      padding: 2px 6px;
      font-size: 11px;
      color: #BBF7D0;
      background: rgba(22,163,74,0.18);
    }

    .secondary-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }

    @media (max-width: 540px) {
      .secondary-grid {
        grid-template-columns: 1fr;
      }
    }

    .secondary-card {
      border-radius: 10px;
      border: 1px solid var(--gj-border-soft);
      background: #020617;
      padding: 8px;
    }

    .secondary-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--gj-muted);
      margin-bottom: 4px;
    }

    .secondary-value {
      font-size: 15px;
      font-weight: 600;
      color: #F9FAFB;
    }

    .secondary-caption {
      margin-top: 3px;
      font-size: 11px;
      color: var(--gj-muted);
    }

    .mf-block {
      margin-top: 10px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #064E3B;
      padding: 8px;
    }

    .mf-tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #6EE7B7;
      margin-bottom: 4px;
    }

    .mf-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .mf-chip {
      border-radius: 999px;
      border: 1px solid #22C55E;
      padding: 4px 8px;
      font-size: 11px;
      background: #020617;
      color: #BBF7D0;
    }

    .mf-note {
      margin-top: 5px;
      font-size: 11px;
      color: var(--gj-muted);
    }

    .badge-card {
      margin-top: 8px;
      border-radius: 10px;
      border: 1px dashed var(--gj-border-soft);
      background: #020617;
      padding: 8px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .badge-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: rgba(248, 165, 32, 0.18);
      color: #FDE68A;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-text {
      font-size: 11px;
      color: var(--gj-grey-dark);
    }

    .delay-card {
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid rgba(248,165,32,0.4);
      background: radial-gradient(circle at top left, #312E81 0, #020617 70%);
      padding: 8px;
    }

    .delay-amount {
      margin-top: 4px;
      font-size: 13px;
      font-weight: 600;
      color: #FCA5A5;
    }

    .delay-caption {
      font-size: 11px;
      color: var(--gj-muted);
      margin-top: 4px;
    }

    .results-actions {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .btn-secondary {
      border-radius: 18px;
      padding: 7px 14px;
      border: 1px solid #22C55E;
      background: #020617;
      color: #BBF7D0;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-secondary:hover {
      background: rgba(34,197,94,0.12);
    }

    .btn-ghost {
      border-radius: 18px;
      padding: 7px 14px;
      border: 1px dashed var(--gj-border-soft);
      background: #020617;
      color: var(--gj-grey-dark);
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost:hover {
      background: #111827;
    }

    .results-footer {
      margin-top: 10px;
      font-size: 10px;
      color: var(--gj-muted);
      line-height: 1.4;
    }

    @media print {
      .header,
      .chat-panel,
      .results-actions {
        display: none !important;
      }
      body {
        background: #FFFFFF;
        color: #000000;
      }
      .main {
        padding: 10px;
      }
      .results-panel {
        height: auto;
        max-height: none;
        background: #FFFFFF;
        color: #000000;
      }
      .results-main,
      .secondary-card,
      .mf-block,
      .badge-card,
      .delay-card {
        background: #FFFFFF;
        border-color: #E5E7EB;
        color: #000000;
      }
      .corpus-value,
      .secondary-value,
      .badge-text {
        color: #000000;
      }
    }
  </style>
</head>
<body>
<div class="shell">
  <header class="header">
    <div class="logo-wrap">
      <div class="logo-block"></div>
      <div class="logo-text">FIRE Readiness Chat</div>
    </div>
    <div class="header-cta">
      <span>Mutual Fund ¬∑ SIP ¬∑ Financial Independence</span>
      <button class="btn-header" type="button">üìû Request a call back</button>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <div class="layout">
        <!-- CHAT PANEL -->
        <section class="chat-panel">
          <div class="chat-header">
            <div class="coach-avatar">üî•</div>
            <div class="coach-text-block">
              <span class="coach-name" id="coachName">FIRE Coach</span>
              <span class="coach-sub">Let‚Äôs chat and build your FIRE snapshot in under 2 minutes.</span>
            </div>
          </div>
          <div class="chat-body" id="chatBody">
            <!-- Bubbles will be injected here -->
          </div>
          <div class="chat-footer" id="chatFooter">
            <!-- Step-specific input will be injected here -->
          </div>
        </section>

        <!-- RESULTS PANEL -->
        <section class="results-panel">
          <div class="results-header">
            <div class="results-title" id="resultsTitle">Your personalised FIRE report</div>
            <div class="results-sub" id="resultsSub">
              I‚Äôll update this panel as you answer each question on the left.
            </div>
          </div>

          <div class="results-main">
            <div class="corpus-label">Estimated FIRE corpus (freedom number)</div>
            <div class="corpus-value" id="corpusOutput">‚Çπ ‚Äî</div>
            <div class="corpus-caption" id="corpusNote">
              We‚Äôll estimate your ‚Äúfreedom number‚Äù after you share your lifestyle, expenses and FIRE age.
            </div>

            <div class="bar-wrap">
              <div class="bar-row">
                <span>FIRE readiness bar</span>
                <span class="score-pill">Score: <span id="scoreOutput">‚Äî</span>/100</span>
              </div>
              <div class="bar-outer">
                <div class="bar-inner" id="readinessBar"></div>
              </div>
            </div>
          </div>

          <div class="secondary-grid">
            <div class="secondary-card">
              <div class="secondary-title">Suggested monthly SIP</div>
              <div class="secondary-value" id="sipOutput">‚Çπ ‚Äî</div>
              <div class="secondary-caption" id="sipNote">
                Once we have your details, we‚Äôll show an indicative SIP amount based on long-term mutual fund returns.
              </div>
            </div>
            <div class="secondary-card">
              <div class="secondary-title">Years to FIRE</div>
              <div class="secondary-value" id="yearsToFireOutput">‚Äî yrs</div>
              <div class="secondary-caption" id="yearsNote">
                This is simply the difference between your target FIRE age and your current age.
              </div>
            </div>
          </div>

          <div class="mf-block">
            <div class="mf-tag">Indicative mutual fund category mix</div>
            <div class="secondary-caption" id="mfMixText">
              After your FIRE snapshot is ready, I‚Äôll suggest an example mix of equity, hybrid and debt categories based on your time to FIRE and risk style.
            </div>
            <div class="mf-row" id="mfChipsRow" style="display:none;"></div>
            <div class="mf-note">
              This is an educational illustration only, not a recommendation for any specific scheme. Your Relationship Manager / advisor can help you choose actual schemes as per regulations and your risk profile.
            </div>
          </div>

          <div class="badge-card">
            <div>
              <div class="badge-pill" id="badgePill">
                <span>üî•</span><span id="badgeLabel">Spark Starter</span>
              </div>
              <div class="badge-text" id="badgeText">
                Answer a few questions in the chat to see where you stand on your FIRE journey.
              </div>
            </div>
            <button class="btn-secondary" type="button" id="copySummaryBtn">üìã Copy summary</button>
          </div>

          <div class="delay-card">
            <div class="secondary-title">What if you delay starting your SIP?</div>
            <div class="slider-row" style="margin-top:4px;">
              <input id="delaySlider" type="range" min="0" max="10" value="1" />
              <div class="slider-pill" id="delayValue">Delay: 1 year</div>
            </div>
            <div class="delay-amount" id="delayAmount">‚Çπ ‚Äî potential value you might leave on the table.</div>
            <div class="delay-caption">
              This is a simplified illustration using long-term equity mutual fund return assumptions.
              Actual outcomes will differ, but it shows why starting early often helps.
            </div>
          </div>

          <div class="results-actions">
            <button class="btn-secondary" type="button" id="whatsappBtn">üí¨ Share via WhatsApp</button>
            <button class="btn-ghost" type="button" onclick="window.print();">‚¨á Download / Print report</button>
          </div>

          <div class="results-footer">
            <p>
              This FIRE readiness chat is for educational and engagement purposes only. It uses simple assumptions
              to help you visualise mutual fund SIPs and long-term compounding in an Indian context.
            </p>
            <p>
              It is not investment advice or a recommendation for any specific product. Please consult your Relationship
              Manager / SEBI-registered investment advisor before making investment decisions.
            </p>
          </div>
        </section>
      </div>
    </div>
  </main>
</div>

<script>
  // ---- Helpers ----
  function formatINR(num) {
    if (!isFinite(num) || num <= 0) return "‚Çπ ‚Äî";
    return "‚Çπ" + Math.round(num).toLocaleString("en-IN");
  }
  function clamp(v, min, max) {
    return Math.min(max, Math.max(min, v));
  }

  // ---- State ----
  const state = {
    name: "",
    email: "",
    mobile: "",
    monthlyExpense: 60000,
    age: 30,
    fireAge: 55,
    lifestyleFactor: 1,
    lifestyleLabel: "Regular FIRE",
    currentCorpus: 0,
    riskStyle: "Balanced",
    score: 0,
    corpus: 0,
    sip: 0,
    yearsToFire: 25
  };

  let currentStep = 0;
  const steps = [
    "askName",
    "askEmail",
    "askMobile",
    "askLifestyle",
    "askExpense",
    "askAge",
    "askFireAge",
    "askCorpus",
    "askRiskStyle",
    "showSummary"
  ];

  // ---- DOM refs ----
  const chatBody = document.getElementById("chatBody");
  const chatFooter = document.getElementById("chatFooter");
  const coachNameEl = document.getElementById("coachName");

  const corpusOutput = document.getElementById("corpusOutput");
  const corpusNote = document.getElementById("corpusNote");
  const readinessBar = document.getElementById("readinessBar");
  const scoreOutput = document.getElementById("scoreOutput");
  const sipOutput = document.getElementById("sipOutput");
  const sipNote = document.getElementById("sipNote");
  const yearsToFireOutput = document.getElementById("yearsToFireOutput");
  const yearsNote = document.getElementById("yearsNote");
  const resultsTitle = document.getElementById("resultsTitle");
  const resultsSub = document.getElementById("resultsSub");

  const mfMixText = document.getElementById("mfMixText");
  const mfChipsRow = document.getElementById("mfChipsRow");
  const badgePill = document.getElementById("badgePill");
  const badgeLabel = document.getElementById("badgeLabel");
  const badgeText = document.getElementById("badgeText");

  const delaySlider = document.getElementById("delaySlider");
  const delayValue = document.getElementById("delayValue");
  const delayAmount = document.getElementById("delayAmount");

  const whatsappBtn = document.getElementById("whatsappBtn");
  const copySummaryBtn = document.getElementById("copySummaryBtn");

  // ----- Chat rendering -----
  function appendAssistant(html) {
    const bubble = document.createElement("div");
    bubble.className = "bubble bubble-assistant";
    bubble.innerHTML = html;
    chatBody.appendChild(bubble);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  function appendUser(text) {
    const bubble = document.createElement("div");
    bubble.className = "bubble bubble-user";
    bubble.textContent = text;
    chatBody.appendChild(bubble);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  function clearFooter() {
    chatFooter.innerHTML = "";
  }

  function updateDelayUI() {
    const years = parseInt(delaySlider.value, 10) || 0;
    delayValue.textContent = "Delay: " + years + (years === 1 ? " year" : " years");
  }
  delaySlider.addEventListener("input", () => {
    updateDelayUI();
    updateDelayImpact();
  });
  updateDelayUI();

  // ---- Conversation Steps ----
  function renderStep() {
    clearFooter();
    const step = steps[currentStep];

    if (step === "askName") {
      appendAssistant("<span class='bubble-label'>Let‚Äôs start</span>üëã Hey! I‚Äôm your <span class='bubble-strong'>FIRE Coach</span>.<br/>I help you figure out <span class='bubble-strong'>when you can stop working for money</span>.<br/><br/>What should I call you?");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Type your name</div>
        <div class="input-row">
          <input type="text" id="nameInput" class="chat-input" placeholder="Eg: Rahul Menon" />
          <button class="btn-next" id="btnName">Next ‚Üí</button>
        </div>
        <div class="error-text" id="nameError" style="display:none;">Please enter your name.</div>
      `;
      chatFooter.appendChild(wrapper);
      const nameInput = document.getElementById("nameInput");
      const nameError = document.getElementById("nameError");
      nameInput.focus();
      document.getElementById("btnName").onclick = () => {
        const val = nameInput.value.trim();
        if (!val) {
          nameError.style.display = "block";
          return;
        }
        nameError.style.display = "none";
        state.name = val;
        coachNameEl.textContent = "FIRE Coach for " + val.split(" ")[0];
        resultsTitle.textContent = val + ", here‚Äôs your FIRE snapshot";
        resultsSub.textContent = "As we chat, I‚Äôll build this personalised FIRE report for you.";
        appendUser(val);
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askEmail") {
      appendAssistant("‚ú® Nice to meet you, <span class='bubble-strong'>" + state.name + "</span>!<br/><br/>Where should I send your <span class='bubble-strong'>Freedom Report + FIRE Score</span>?<br/><br/>üìß Please enter your email.");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Email address</div>
        <div class="input-row">
          <input type="email" id="emailInput" class="chat-input" placeholder="name@example.com" />
          <button class="btn-next" id="btnEmail">Next ‚Üí</button>
        </div>
        <div class="error-text" id="emailError" style="display:none;">Please enter a valid email address.</div>
      `;
      chatFooter.appendChild(wrapper);
      const emailInput = document.getElementById("emailInput");
      const emailError = document.getElementById("emailError");
      emailInput.focus();
      document.getElementById("btnEmail").onclick = () => {
        const val = emailInput.value.trim();
        const valid = !val || /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val);
        if (!valid) {
          emailError.style.display = "block";
          return;
        }
        emailError.style.display = "none";
        state.email = val;
        appendUser(val || "(Skipped email)");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askMobile") {
      appendAssistant("Got it ‚úîÔ∏è<br/><br/>üì± And your mobile number?<br/><span class='tiny-caption'>Only for sending your PDF report & for an RM to help you if you want. No spam.</span>");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Mobile number (optional)</div>
        <div class="input-row">
          <input type="tel" id="mobileInput" class="chat-input" placeholder="10-digit mobile number" />
          <button class="btn-next" id="btnMobile">Next ‚Üí</button>
        </div>
        <div class="error-text" id="mobileError" style="display:none;">Please enter a valid 10-digit mobile number or leave blank.</div>
      `;
      chatFooter.appendChild(wrapper);
      const mobileInput = document.getElementById("mobileInput");
      const mobileError = document.getElementById("mobileError");
      mobileInput.focus();
      document.getElementById("btnMobile").onclick = () => {
        const val = mobileInput.value.trim();
        let valid = true;
        if (val && !/^\d{10}$/.test(val)) valid = false;
        if (!valid) {
          mobileError.style.display = "block";
          return;
        }
        mobileError.style.display = "none";
        state.mobile = val;
        appendUser(val || "(Skipped mobile)");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askLifestyle") {
      appendAssistant("Awesome, " + state.name.split(" ")[0] + "! üöÄ<br/><br/>At retirement, what kind of <span class='bubble-strong'>lifestyle</span> do you dream of?");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Choose a lifestyle</div>
        <div class="lifestyle-row">
          <button type="button" class="lifestyle-btn" data-factor="0.9" data-label="Lean FIRE">üßò Lean FIRE</button>
          <button type="button" class="lifestyle-btn selected" data-factor="1" data-label="Regular FIRE">üè° Regular FIRE</button>
          <button type="button" class="lifestyle-btn" data-factor="1.2" data-label="Fat FIRE">üíé Fat FIRE</button>
        </div>
        <div style="margin-top:6px;">
          <button class="btn-next" id="btnLifestyle">Next ‚Üí</button>
        </div>
      `;
      chatFooter.appendChild(wrapper);
      const buttons = wrapper.querySelectorAll(".lifestyle-btn");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          buttons.forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          state.lifestyleFactor = parseFloat(btn.getAttribute("data-factor")) || 1;
          state.lifestyleLabel = btn.getAttribute("data-label") || "Regular FIRE";
        });
      });
      document.getElementById("btnLifestyle").onclick = () => {
        appendUser(state.lifestyleLabel);
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askExpense") {
      appendAssistant("Now, how much do you currently spend per month on your <span class='bubble-strong'>living expenses</span>?<br/>This includes rent/EMI, groceries, school fees, utilities, lifestyle etc.");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Estimate your current monthly expense</div>
        <div class="slider-row">
          <input id="expenseSlider" type="range" min="15000" max="200000" step="5000" value="${state.monthlyExpense}" />
          <div class="slider-pill" id="expenseValue">‚Çπ${state.monthlyExpense.toLocaleString("en-IN")}</div>
        </div>
        <div class="tiny-caption" id="expenseMood">üôÇ Balanced lifestyle spend.</div>
        <div style="margin-top:6px;">
          <button class="btn-next" id="btnExpense">Next ‚Üí</button>
        </div>
      `;
      chatFooter.appendChild(wrapper);
      const expenseSlider = document.getElementById("expenseSlider");
      const expenseValue = document.getElementById("expenseValue");
      const expenseMood = document.getElementById("expenseMood");
      function updateExpenseUI() {
        const val = parseInt(expenseSlider.value, 10) || 0;
        expenseValue.textContent = "‚Çπ" + val.toLocaleString("en-IN");
        let mood = "üôÇ Balanced lifestyle spend.";
        if (val < 30000) mood = "üòå Minimal cost of living.";
        else if (val > 100000) mood = "üòé Premium lifestyle spend.";
        expenseMood.textContent = mood;
      }
      expenseSlider.addEventListener("input", updateExpenseUI);
      updateExpenseUI();
      document.getElementById("btnExpense").onclick = () => {
        state.monthlyExpense = parseInt(expenseSlider.value, 10) || 60000;
        appendUser("‚Çπ" + state.monthlyExpense.toLocaleString("en-IN") + " per month");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askAge") {
      appendAssistant("Got it üí∏<br/><br/>What‚Äôs your <span class='bubble-strong'>age today</span>?");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Slide to set your age</div>
        <div class="slider-row">
          <input id="ageSlider" type="range" min="22" max="55" value="${state.age}" />
          <div class="slider-pill" id="ageValue">${state.age} years</div>
        </div>
        <div class="tiny-caption">You can adjust this later if needed.</div>
        <div style="margin-top:6px;">
          <button class="btn-next" id="btnAge">Next ‚Üí</button>
        </div>
      `;
      chatFooter.appendChild(wrapper);
      const ageSlider = document.getElementById("ageSlider");
      const ageValue = document.getElementById("ageValue");
      ageSlider.addEventListener("input", () => {
        ageValue.textContent = ageSlider.value + " years";
      });
      document.getElementById("btnAge").onclick = () => {
        state.age = parseInt(ageSlider.value, 10) || 30;
        appendUser(state.age + " years");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askFireAge") {
      appendAssistant("And at what age would you like <span class='bubble-strong'>work to be optional</span>?<br/>That‚Äôs your target FIRE age.");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Slide to set your FIRE age</div>
        <div class="slider-row">
          <input id="fireAgeSlider" type="range" min="40" max="65" value="${state.fireAge}" />
          <div class="slider-pill" id="fireAgeValue">${state.fireAge} years</div>
        </div>
        <div class="tiny-caption">More years = more time for your SIPs to compound.</div>
        <div style="margin-top:6px;">
          <button class="btn-next" id="btnFireAge">Next ‚Üí</button>
        </div>
      `;
      chatFooter.appendChild(wrapper);
      const fireAgeSlider = document.getElementById("fireAgeSlider");
      const fireAgeValue = document.getElementById("fireAgeValue");
      fireAgeSlider.addEventListener("input", () => {
        fireAgeValue.textContent = fireAgeSlider.value + " years";
      });
      document.getElementById("btnFireAge").onclick = () => {
        state.fireAge = parseInt(fireAgeSlider.value, 10) || 55;
        appendUser(state.fireAge + " years");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askCorpus") {
      appendAssistant("Last factual bit‚Ä¶ üòä<br/><br/>Roughly how much have you already saved <span class='bubble-strong'>specifically for retirement</span>?<br/>You can leave this as 0 if you‚Äôre just starting.");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Approximate corpus set aside for retirement (optional)</div>
        <div class="input-row">
          <input type="number" id="corpusInput" class="chat-input" placeholder="Eg: 500000 for ‚Çπ5,00,000" min="0" />
          <button class="btn-next" id="btnCorpus">Next ‚Üí</button>
        </div>
        <div class="tiny-caption">If you‚Äôre just starting, you can leave this blank.</div>
      `;
      chatFooter.appendChild(wrapper);
      const corpusInput = document.getElementById("corpusInput");
      corpusInput.focus();
      document.getElementById("btnCorpus").onclick = () => {
        const val = corpusInput.value.trim();
        state.currentCorpus = parseFloat(val || "0") || 0;
        appendUser(state.currentCorpus > 0 ? formatINR(state.currentCorpus) : "No corpus yet / starting now");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "askRiskStyle") {
      appendAssistant("Before I show your FIRE Score‚Ä¶<br/><br/>Do you want your plan to feel more <span class='bubble-strong'>cautious, balanced or bold</span>?");
      const wrapper = document.createElement("div");
      wrapper.className = "chat-input-area";
      wrapper.innerHTML = `
        <div class="field-label">Pick a style</div>
        <div class="risk-row">
          <button type="button" class="risk-btn" data-risk="Cautious">üõ°Ô∏è Cautious</button>
          <button type="button" class="risk-btn selected" data-risk="Balanced">‚öñÔ∏è Balanced</button>
          <button type="button" class="risk-btn" data-risk="Bold">üöÄ Bold</button>
        </div>
        <div style="margin-top:6px;">
          <button class="btn-next" id="btnRisk">See my FIRE Score ‚Üí</button>
        </div>
      `;
      chatFooter.appendChild(wrapper);
      const buttons = wrapper.querySelectorAll(".risk-btn");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          buttons.forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          state.riskStyle = btn.getAttribute("data-risk") || "Balanced";
        });
      });
      document.getElementById("btnRisk").onclick = () => {
        appendUser(state.riskStyle + " plan");
        currentStep++;
        renderStep();
      };
    }

    else if (step === "showSummary") {
      appendAssistant("üî• Ready, <span class='bubble-strong'>" + state.name.split(" ")[0] + "</span>?<br/>I‚Äôm calculating your FIRE Score and SIP now‚Ä¶");
      clearFooter();
      // Simulate small delay
      setTimeout(() => {
        computeAndRender();
        appendAssistant("üéØ Here‚Äôs your FIRE snapshot on the right ‚Äì including your <span class='bubble-strong'>Score, Freedom Number, SIP</span> and a sample mutual fund category mix.<br/><br/>You can also drag the <span class='bubble-strong'>delay slider</span> on the right to see what happens if you postpone starting your SIP.");
      }, 900);
    }
  }

  // MF mix suggestion based on years + risk
  function getMfMix(yearsToFIRE, riskStyle) {
    const risk = riskStyle || "Balanced";
    if (yearsToFIRE >= 20) {
      if (risk === "Bold") {
        return {
          text: "You have a long runway and a bold style. Many investors in this zone keep a high equity tilt with some space for thematic or international funds.",
          chips: [
            "Equity: 85% (Flexi / Mid / Index)",
            "International / Thematic: 10%",
            "Hybrid / Balanced Advantage: 5%"
          ]
        };
      } else if (risk === "Cautious") {
        return {
          text: "Long time horizon with a cautious style ‚Äì you can still use equity for growth, but with a meaningful hybrid allocation.",
          chips: [
            "Equity: 65% (Large / Flexi / Index)",
            "Hybrid / Balanced Advantage: 25%",
            "Short Duration Debt: 10%"
          ]
        };
      } else {
        return {
          text: "You have a long runway. A higher equity allocation with some hybrid exposure is a common approach for long-term growth.",
          chips: [
            "Equity: 80% (Large / Flexi / Index)",
            "Hybrid / Balanced Advantage: 20%"
          ]
        };
      }
    } else if (yearsToFIRE >= 10) {
      if (risk === "Bold") {
        return {
          text: "Balanced horizon with a bold style ‚Äì still equity-focused, but with some hybrid and debt for stability.",
          chips: [
            "Equity: 70%",
            "Hybrid / Balanced Advantage: 20%",
            "Short Duration / Corporate Bond: 10%"
          ]
        };
      } else if (risk === "Cautious") {
        return {
          text: "With a cautious style, you may want more stability ‚Äì a stronger hybrid + debt allocation can help smooth the ride.",
          chips: [
            "Equity: 50%",
            "Hybrid / Balanced Advantage: 30%",
            "Short Duration / Corporate Bond: 20%"
          ]
        };
      } else {
        return {
          text: "A balanced mix can work well ‚Äì equity for growth, hybrid for stability and a slice of short-duration debt.",
          chips: [
            "Equity: 60%",
            "Hybrid / Balanced Advantage: 30%",
            "Short Duration / Corporate Bond: 10%"
          ]
        };
      }
    } else {
      if (risk === "Bold") {
        return {
          text: "You‚Äôre closer to your FIRE age, but still prefer a bold stance. Many investors keep a meaningful equity portion but lean more into hybrid and short-duration debt.",
          chips: [
            "Equity: 50%",
            "Hybrid / Balanced Advantage: 30%",
            "Short Duration / Corporate Bond: 20%"
          ]
        };
      } else if (risk === "Cautious") {
        return {
          text: "Closer to FIRE age with a cautious style ‚Äì typically more hybrid and debt, with limited equity exposure.",
          chips: [
            "Equity: 30%",
            "Hybrid / Balanced Advantage: 40%",
            "Short Duration / Corporate Bond: 30%"
          ]
        };
      } else {
        return {
          text: "Closer to FIRE age, many investors tilt more to hybrid and debt to moderate risk and volatility.",
          chips: [
            "Equity: 40%",
            "Hybrid / Balanced Advantage: 40%",
            "Short Duration / Corporate Bond: 20%"
          ]
        };
      }
    }
  }

  // FIRE calculations
  function computeAndRender() {
    const yearlyExpense = state.monthlyExpense * 12;
    const yearsToFIRE = Math.max(1, state.fireAge - state.age);
    const corpus = yearlyExpense * 25 * state.lifestyleFactor; // 25x rule

    const readiness = corpus > 0 ? clamp(state.currentCorpus / corpus, 0, 1) : 0;
    const yearsFactor = clamp(yearsToFIRE / 35, 0, 1);
    const score = Math.round(readiness * 70 + yearsFactor * 30);

    const r = 0.11 / 12; // 11% annual in mutual funds (approx, illustrative)
    const n = yearsToFIRE * 12;
    let sip = 0;
    if (corpus > state.currentCorpus && n > 0 && r > 0) {
      const targetFuture = corpus - state.currentCorpus;
      const factor = (Math.pow(1 + r, n) - 1) / r;
      sip = targetFuture / factor;
    }

    state.corpus = corpus;
    state.yearsToFire = yearsToFIRE;
    state.score = isFinite(score) ? score : 0;
    state.sip = sip;

    // Update results panel
    corpusOutput.textContent = formatINR(corpus);
    corpusNote.textContent =
      "Approximate FIRE corpus for a " + state.lifestyleLabel +
      " lifestyle, assuming about 25√ó your annual expenses.";

    readinessBar.style.width = (readiness * 100).toFixed(0) + "%";
    scoreOutput.textContent = isFinite(score) ? score : "‚Äî";

    yearsToFireOutput.textContent = yearsToFIRE + " yrs";
    yearsNote.textContent =
      "You have roughly " + yearsToFIRE +
      " years for your mutual fund SIPs to compound before your FIRE age.";

    sipOutput.textContent = sip > 0 ? formatINR(sip) + "/month" : "‚Çπ ‚Äî";
    sipNote.textContent =
      sip > 0
        ? "A steady SIP of this amount into suitable mutual funds could help you move towards this FIRE corpus over time."
        : "Try adjusting your FIRE age or expenses to see an indicative SIP.";

    // Personalise summary title if not already
    if (state.name) {
      resultsTitle.textContent = state.name + ", here‚Äôs your FIRE snapshot";
    }

    // Badge
    updateBadge(state.score);

    // MF mix
    const mix = getMfMix(yearsToFIRE, state.riskStyle);
    mfMixText.textContent = mix.text;
    mfChipsRow.innerHTML = "";
    mix.chips.forEach(label => {
      const chip = document.createElement("div");
      chip.className = "mf-chip";
      chip.textContent = label;
      mfChipsRow.appendChild(chip);
    });
    mfChipsRow.style.display = "flex";

    // Delay impact
    updateDelayImpact();
  }

  function updateBadge(score) {
    let label = "Spark Starter";
    let text = "You‚Äôre switching on the FIRE light. A simple, consistent SIP can turn this spark into something meaningful.";
    let emoji = "üî•";

    if (score >= 41 && score <= 60) {
      label = "Flame Builder";
      text = "You‚Äôve already taken some good steps. Keeping your SIP regular and increasing it with income can strengthen your FIRE path.";
      emoji = "üî•üî•";
    } else if (score >= 61 && score <= 80) {
      label = "FIRE Warrior";
      text = "You‚Äôre doing many things right. Fine-tuning your asset mix and SIP amount yearly can keep you on track for early freedom.";
      emoji = "üî•üî•üî•";
    } else if (score > 80) {
      label = "Freedom Seeker";
      text = "You‚Äôre in a strong position. Protecting your discipline and avoiding lifestyle creep will help you guard this advantage.";
      emoji = "üí∏üî•";
    }

    badgeLabel.textContent = label;
    badgePill.querySelector("span").textContent = emoji;
    badgeText.textContent = text;
  }

  function updateDelayImpact() {
    const delayYears = parseInt(delaySlider.value, 10) || 0;
    if (!state.sip || state.sip <= 0 || delayYears <= 0) {
      delayAmount.textContent = "‚Çπ ‚Äî potential value you might leave on the table.";
      return;
    }
    const r = 0.11 / 12;
    const months = delayYears * 12;
    const factor = (Math.pow(1 + r, months) - 1) / r;
    const lost = state.sip * factor;
    delayAmount.textContent =
      formatINR(lost) +
      " is the approximate future value you might miss if you delay your SIP by " +
      delayYears +
      (delayYears === 1 ? " year." : " years.");
  }

  // Share + copy
  copySummaryBtn.addEventListener("click", () => {
    if (!state.corpus || !state.yearsToFire) {
      alert("Please finish the chat to generate your FIRE snapshot first.");
      return;
    }
    const namePart = state.name ? (state.name + " ‚Äì FIRE readiness snapshot\n\n") : "";
    const msg =
      namePart +
      "FIRE Score: " + state.score + "/100\n" +
      "Estimated FIRE Corpus: " + formatINR(state.corpus) + "\n" +
      "Indicative SIP: " + (state.sip > 0 ? formatINR(state.sip) + "/month" : "‚Äî") + "\n" +
      "Years to FIRE: " + state.yearsToFire + "\n\n" +
      "This is an educational illustration using Geojit‚Äôs FIRE Readiness chat tool.";
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(msg).then(() => {
        alert("Summary copied. You can paste it into email, notes or chat.");
      }, () => {
        alert("Copy failed. Please copy manually from the screen.");
      });
    } else {
      alert("Your browser doesn‚Äôt support auto-copy. Please copy manually.");
    }
  });

  whatsappBtn.addEventListener("click", () => {
    if (!state.corpus || !state.yearsToFire) {
      alert("Please finish the chat to generate your FIRE snapshot first.");
      return;
    }
    const intro = state.name
      ? state.name + " just checked their FIRE readiness. "
      : "I just checked my FIRE readiness. ";
    const text =
      intro +
      "FIRE Score: " + state.score + "/100\n" +
      "Estimated FIRE Corpus: " + formatINR(state.corpus) + "\n" +
      "Indicative SIP: " + (state.sip > 0 ? formatINR(state.sip) + "/month" : "‚Äî") + "\n" +
      "Years to FIRE: " + state.yearsToFire + "\n\n" +
      "Check your own FIRE readiness with this mutual fund SIP-based tool.";
    const url = "https://wa.me/?text=" + encodeURIComponent(text);
    window.open(url, "_blank");
  });

  // Start chat
  renderStep();
</script>
</body>
</html>
